(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6b5833a0"],{"35df":function(e,t,s){"use strict";s("a9e3"),s("d3b7");t["a"]={name:"VNotifyCount",functional:!0,props:{count:[String,Number,Promise],top:String,right:String,bottom:String,left:String},render:function(e,t){var s={top:t.props.top,right:t.props.right,bottom:t.props.bottom,left:t.props.left};return t.props.count>0&&e("div",{staticClass:"ol-notify-count ol-b-orange-dawn",style:s},t.props.count)}}},"680d":function(e,t,s){"use strict";s("7db0"),s("d3b7");var a=s("2ef0"),n=s.n(a);t["a"]={computed:{marks:function(){return[{score:1,color:"red",label:1},{score:2,color:"red",label:2},{score:3,color:"red",label:3},{score:4,color:"orange",label:4},{score:5,color:"orange",label:5},{score:6,color:"orange",label:6},{score:7,color:"orange",label:7},{score:8,color:"green",label:8},{score:9,color:"green",label:9},{score:10,color:"green",label:10}]},marksPass:function(){return[{score:0,color:"orange",label:this.trans("spa.label.fail")},{score:1,color:"green",label:this.trans("spa.label.pass")}]}},methods:{getMark:function(e,t){return"pass"===t?n.a.find(this.marksPass,(function(t){return t.score===parseInt(e,10)}))||{label:e}:e?n.a.find(this.marks,(function(t){return t.score===parseInt(e,10)}))||{label:e}:{label:this.trans("homework.on_verification")}},getMarkColor:function(e,t){var s=this.getMark(e,t);if(s&&s.color)switch(s.color){case"red":return"ol-c-red";case"orange":return"ol-c-orange";case"green":return"ol-c-green";default:return""}return""},getScore:function(e){var t=n.a.find(this.marks,(function(t){return t.score===e}));return t||{score:"",color:"",label:""}}}}},b7a4:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ol-view__page ol-view__schedule"},[s("div",{staticClass:"ol-container-content"},[s("div",{staticClass:"sa-title"},[s("span",[e._v(e._s(e.trans("olessons.title.schedule")))])]),s("v-schedule",{class:e.selectColorByQuarter,on:{empty:function(t){e.isEmpty=t}},scopedSlots:e._u([{key:"table",fn:function(t){var a=t.table,n=t.day,r=t.multiSchool;return[e.isEmpty?e._e():s("v-table",{class:{"ol-view__table-schedule-personnel":e.isEmployee,"ol-view__table-schedule":!e.isEmployee,"ol-view__table-schedule-personnel--orange-border":e.$store.getters.getEditModeState},attrs:{columns:e.columns,rows:a.rows,border:"",striped:""},scopedSlots:e._u([{key:"body",fn:function(){return e._l(a.rows,(function(t,a){return s("v-table-tr",{key:a,class:{"ol-view__table-schedule--exam":"sor"===t.type,"ol-view__table-schedule--exam-soch":"soch"===t.type,"ol-view__table-schedule--sync":t.isSyncLesson}},e._l(e.columns,(function(a,i){return s("v-table-td",{key:i,class:{"ol-view__table-schedule--additional":"theme"===a.name&&t[a.name].additional},attrs:{label:t[a.name]&&""!==t[a.name].label&&t[a.name].label||t.itsExam&&"theme"===a.name&&t[a.name]&&""===t[a.name].label&&e.trans("olessons.table.theme_not")||"",additional:t[a.name]&&t[a.name].additional,align:a.align,"table-head":a.label}},["subject"===a.name&&t[a.name]?s("span",[e._v(" "+e._s(t[a.name].label)+" "),s("span",{staticClass:"ol-table__td-additional"},[e._v(" "+e._s(t[a.name].additional)+" ")]),t.subgroup?s("span",{staticClass:"sa-subgroup",staticStyle:{"margin-right":"0.5rem"}},[e._v(e._s(t.subgroup))]):e._e(),t.subject&&"elective"===t.subject.subjectType?s("span",{staticClass:"sa-faculty"},[e._v(" "+e._s(e.trans("spa.label.subject_elective"))+" ")]):e._e(),e.isBirgeOqy&&r&&t.class&&t.class.schoolName?s("span",{staticClass:"ol-table__td-additional ol-normal"},[e._v(" "+e._s(e.multiSchoolTitle(t))+" ")]):e._e(),e.isEmployee?e._e():s("div",{staticClass:"sa-schedule-cell__item-teacher mt-10",class:{"ol-c-red-pink":!t.teacher&&!("sor"===t.type||"soch"===t.type),"ol-c-white":"sor"===t.type||"soch"===t.type},attrs:{title:t.teacher}},[s("div",{staticClass:"ol-str-ico ol-ico--fa ol-ico--thm-user ol-ellipsis"},[e._v(" "+e._s(t.teacher||e.trans("spa.label.not_set"))+" ")])])]):e._e(),"time"===a.name&&t[a.name]?s("span",[s("div",[t[a.name].label||t.cabinet&&(!t.cabinet||t.cabinet.number||t.cabinet.name)?s("span",[e._v(" "+e._s(t[a.name].label)+" ")]):s("span",{staticClass:"ol-table__span-default"},[e._v(e._s(e.trans("olessons.table.free_time")))])]),t.cabinet?s("div",[t.cabinet.number||t.cabinet.name?s("span",{staticClass:"ol-table__td-additional"},[e._v(" "+e._s((t.cabinet.number||"")+" - "+(t.cabinet.name||"")+" ")+" ")]):e._e()]):e._e()]):e._e(),"theme"===a.name&&t[a.name]&&t[a.name].label&&!t.isVisible&&e.isEmployee?s("div",{staticClass:"d-flex"},[s("div",{staticClass:"ol-tooltip align-items-center d-flex"},["regular"!==t.type?s("span",{staticClass:"ol-ico ol-ico--fa ol-ico--thm-exclamation-box\n                           ol-ico--size-b ol-bold",class:"sor"===t.type||"soch"===t.type?"ol-c-white":"ol-c-red-pink",staticStyle:{"padding-right":"1rem",display:"table-cell"}}):e._e(),s("span",{staticClass:"ol-tooltip__text"},[e._v(" "+e._s(e.trans("spa.tooltip.lesson.not_visible"))+" ")])]),s("div",[s("span",[e._v(" "+e._s(t[a.name].label)+" ")])])]):e._e(),"cabinet"===a.name?s("div",[t[a.name].number||t[a.name].name?s("span",[e._v(" "+e._s(t[a.name].number||"")+" "+e._s(t[a.name].name||"")+" ")]):s("span",[e._v(" "+e._s(e.trans("olessons.table.cabinet_not"))+" ")])]):e._e(),"theme"===a.name&&t[a.name]&&!t[a.name].label&&"sor"!==t.type?s("div",{staticClass:"ol-tooltip align-items-center d-flex"},[s("span",{staticClass:"ol-ico ol-ico--fa ol-ico--thm-exclamation-box\n                           ol-ico--size-b ol-bold",class:"sor"===t.type||"soch"===t.type?"ol-c-white":"ol-c-red-pink",staticStyle:{"padding-right":"1rem",display:"table-cell"}}),s("span",{staticClass:"ol-tooltip__text"},[e._v(" "+e._s(e.trans("spa.tooltip.lesson.not_visible"))+" ")]),s("span",{staticClass:"ol-table__span-default ol-c-form-warning"},[e._v(" "+e._s(e.trans("olessons.table.theme_not"))+" ")])]):e._e(),t[a.name]&&("sor"!==t.type&&"soch"!==t.type&&t.theme.label||"homework"!==a.name)&&t[a.name].status?s("v-btn",{staticClass:"ol-w-100 ol-notify-count__wrapper",attrs:{tag:"button",color:t.isSyncLesson&&"lesson"===a.name?"red-pink":t[a.name].score&&e.getScore(t[a.name].score).color||e.getButton(t,a.name).color,outline:!!t[a.name].score||e.getButton(t,a.name).outline,disable:e.getButton(t,a.name,n).disable},on:{click:function(s){return e.transportTo(n,t,a.name)}}},[t[a.name].status&&t[a.name].count?s("div",{staticClass:"ol-notify-count ol-notify-count--minify ol-b-orange-dawn",staticStyle:{top:"-0.7rem",right:"-0.7rem"}},[s("span",[e._v(e._s(t[a.name].count))])]):e._e(),s("span",[e._v(" "+e._s(e.isEmployee?e.getButton(t,a.name).label:null!==t[a.name].score?e.trans("spa.common.score")+": "+t[a.name].score:e.getButton(t,a.name).label)+" ")])]):e._e(),"actions"===a.name?s("div",{staticClass:"ol-icons-row"},[s("v-btn",{attrs:{color:"orange",outline:"",squire:""},on:{click:function(s){return e.openEditModal(t,n.dateFormated)}}},[s("div",{staticClass:"ol-ico ol-ico--fa ol-ico--thm-pencil"})]),s("v-btn",{attrs:{color:"red-pink",outline:"",squire:""},on:{click:function(s){return e.openDeleteModal(t)}}},[s("div",{staticClass:"ol-ico ol-ico--fa ol-ico--thm-times"})])],1):e._e()],1)})),1)}))},proxy:!0}],null,!0)})]}}])})],1)])},n=[],r=s("2909"),i=s("5530"),o=(s("caad"),s("b0c0"),s("d3b7"),s("ac1f"),s("1276"),s("2f62")),l=s("680d"),c=s("79ef"),d=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("v-area",{attrs:{loading:e.loading},scopedSlots:e._u([{key:"headTop",fn:function(){return[s("button",{staticClass:"ol-week__change",style:{visibility:e.weekEndHandler(e.dayIdx,!1)?"hidden":""},on:{click:function(t){return e.changeWeek(!1)}}},[s("span",{staticClass:"ol-str-ico ol-ico--thm-angle-left ol-str-ico--wider"},[s("span",[e._v(e._s(e.trans("olessons.action.prev_week")))])])]),e.$screen.lt.md?e._e():s("div",{staticClass:"ol-week__tabs justify-content-center"},e._l(e.days,(function(t,a){return s("div",{directives:[{name:"show",rawName:"v-show",value:e.groupInfo.startDate<e.firstSeptember.time||t.date>=e.firstSeptember.time,expression:"groupInfo.startDate < firstSeptember.time\n          || day.date >= firstSeptember.time"}],key:a,staticClass:"ol-week__tab",class:{"is-active":e.selectedDay.date===t.date},on:{click:function(t){return e.selectDay(a)}}},[e._v(" "+e._s(e.daysName[a])+" ")])})),0),e.$screen.lt.md?s("div",{staticClass:"ol-week__tabs justify-content-center"},[s("div",{staticClass:"ol-week__tab"},[e._v(" "+e._s(e.daysName[e.dayIdx])+" ")])]):e._e(),s("button",{staticClass:"ol-week__change",style:{visibility:e.weekEndHandler(e.dayIdx)?"hidden":""},on:{click:function(t){return e.changeWeek(!0)}}},[s("span",{staticClass:"ol-str-ico-rev ol-ico--thm-angle-right ol-str-ico--wider"},[s("span",[e._v(e._s(e.trans("olessons.action.next_week")))])])])]},proxy:!0},{key:"headBottom",fn:function(){return[s("div",{staticClass:"ol-view__area-head-bottom"},[e.selectedDay&&e.selectedDay.date?s("div",{staticClass:"ol-today"},[s("div",{staticClass:"ol-today__title"},[e.selectedDay.isCurrent?s("span",{staticClass:"ol-upper ol-medium ol-c-grey-table"},[e._v(" "+e._s(e.trans("olessons.common.today"))+" ")]):e._e(),e._v(" "+e._s(e.selectedDay.date_label)+" ")])]):e._e(),e.getSelectedYear.current?s("div",{staticClass:"row ml-auto ol-view__schedule-controls-edit-buttons"},[e.isEmployee&&e.$store.getters.getEditModeState?s("div",{staticClass:"col-12 col-md-auto"},[s("v-btn",{staticClass:"ol-w-100",attrs:{label:e.trans("spa.action.add_to_schedule"),color:"orange",outline:""},on:{click:e.handleShowModalAddLessonSchedule}})],1):e._e(),e.isEmployee&&!e.hiddenBirgeOqySchools?s("div",{staticClass:"col-12 col-md-auto"},[s("v-btn",{staticClass:"ol-minw-140 ol-w-100",attrs:{label:e.$store.getters.getEditModeState?e.trans("spa.action_save_and_close"):e.trans("olessons.action.edit"),color:e.$store.getters.getEditModeState?"emerald":"orange",outline:e.$store.getters.getEditModeState},on:{click:e.editSchedule}})],1):e._e()]):e._e()])]},proxy:!0},{key:"body",fn:function(){return[e.isNotEmptySchedule&&!e.selectedDay.isHoliday?e._t("table",null,{table:e.table,multiSchool:e.multiSchool,day:{date:e.selectedDay.date,dateFormat:e.selectedDay.dateFormat,isCurrent:e.selectedDay.isCurrent,dateFormated:e.selectedDay.dateFormated,isDisabledWeek:e.selectedDay.isDisabledWeek,isPastDate:e.selectedDay.isPastDate,cabinet:e.selectedDay.cabinet}}):e._e(),e.isNotEmptySchedule||!e.isEmployee||e.selectedDay.isHoliday?e._e():s("v-warning",{attrs:{title:e.trans("olessons.warning.no_schedule_title"),desc:e.trans("olessons.warning.no_schedule_desc"),picture:"no-data-schedule"}}),e.isNotEmptySchedule||e.isEmployee||e.selectedDay.isHoliday?e._e():s("v-warning",{attrs:{title:e.trans("olessons.warning.no_schedule_title"),desc:e.trans("olessons.warning.no_schedule_desc"),picture:"no-data-schedule"}}),e.selectedDay.isHoliday?s("v-warning",{attrs:{title:e.trans("olessons.warning.holiday_title"),desc:e.trans("olessons.warning.holiday_desc"),picture:"holiday"}}):e._e()]},proxy:!0}],null,!0)})],1)},h=[],u=(s("00b4"),s("c740"),s("159b"),s("2532"),s("2ef0")),m=s.n(u),p=s("bc3a"),y=s.n(p),b=s("c1df"),f=s.n(b),g=s("911b"),_=s("1e01"),v=s("5c9f"),w=s("d4ec"),S=s("bee2"),k=s("257e"),D=s("262e"),$=s("2caf"),C=s("d5e4"),P=s("5364"),x=(s("99af"),s("3ca3"),s("10d1"),s("ddb0"),s("dc4c")),I=new WeakMap,q=function(e){Object(D["a"])(s,e);var t=Object($["a"])(s);function s(){var e;Object(w["a"])(this,s);for(var a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n)),Object(C["a"])(Object(k["a"])(e),I,{writable:!0,value:"/api/v2/os/quarters-info"}),e}return Object(S["a"])(s,[{key:"fetchQuartersList",value:function(){return new Promise(function(e,t){var s;return Promise.resolve(this.fetch({url:"".concat(this.domain).concat(Object(P["a"])(this,I))})).then((function(a){try{return s=a,null!==s&&void 0!==s&&s.error||!s.data?e([]):e(s.data)}catch(n){return t(n)}}),t)}.bind(this))}}]),s}(x["a"]),E=s("fa29"),L=s("dc1a"),T={name:"VSchedule",components:{VArea:E["a"],VBtn:c["a"],VWarning:L["a"]},data:function(){return{quarterService:new q(this),modalSelectLessonType:{lessonId:null},multiSchool:!1,loading:!1,edit:!1,needToSetLastDay:!1,firstSeptember:{time:f()("01.09.2021 +0000","DD.MM.YYYY Z").unix(),label:"01.09.2021"}}},mounted:function(){return new Promise(function(e,t){var s,a;if(a=this,this.$route.params.date&&this.$store.commit("setScheduleSelectDate",this.$route.params.date),this.isStudent&&!this.isBirgeOqy&&(null===(s=this.getSelectedQuarter)||void 0===s||!s.startDate))return Promise.resolve(this.requestUsersQuarters()).then(function(e){try{return n.call(this)}catch(s){return t(s)}}.bind(this),t);function n(){return this.selectDate&&g["a"].date.test(this.selectDate)?Promise.resolve(this.reqData(this.selectDate)).then(function(s){try{return this.$eventHub.$on("refresh-schedule",(function(){return a.handleRefreshSchedule(a.selectDate)})),e()}catch(n){return t(n)}}.bind(this),t):(this.$eventHub.$on("refresh-schedule",(function(){return a.handleRefreshSchedule})),Promise.resolve(this.reqData()).then((function(s){try{return e()}catch(a){return t(a)}}),t))}return n.call(this)}.bind(this))},watch:{"$route.params.date":function(e){e||(this.$store.commit("setScheduleSelectDate",""),this.reqData())},days:function(e){var t=this,s=m.a.findIndex(e,(function(e){return e.isCurrent}));this.selectDate&&g["a"].date.test(this.selectDate)&&0===this.dayIdx?e.forEach((function(e,s){e.dateFormat===t.selectDate&&t.selectDay(s)})):s>=0&&0===this.dayIdx&&this.selectDay(s),0===e.length?this.$emit("empty",!0):this.$emit("empty",!1)},getSelectedQuarter:function(){return new Promise(function(e,t){var s,a;return s=this,this.$route.params.date?Promise.resolve(this.reqData(this.$route.params.date)).then(function(e){try{return a=m.a.findIndex(this.days,(function(e){return e.dateFormat===s.$route.params.date})),a>=0?this.selectDay(a):this.needToSetLastDay&&(this.selectDay(this.days.length-1),this.needToSetLastDay=!1),n.call(this)}catch(r){return t(r)}}.bind(this),t):Promise.resolve(this.reqData()).then(function(e){try{return n.call(this)}catch(s){return t(s)}}.bind(this),t);function n(){return e()}}.bind(this))}},computed:Object(i["a"])(Object(i["a"])(Object(i["a"])({},Object(o["c"])(["isEmployee","getSelectedQuarter","getSelectedYear","isStudent","getQuartersList","getSchoolType","isTeacher"])),Object(o["e"])({days:function(e){return e.schedule.days},weeks:function(e){return e.schedule.weeks},groupInfo:function(e){return e.schedule.groupInfo},dayIdx:function(e){return e.schedule.dayIdx},selectDate:function(e){return e.schedule.selectDate}})),{},{selectedDay:function(){return 0===this.days.length?{date:"",dateFormat:"",schedule:[]}:(this.days[this.dayIdx]||this.selectDay(this.days.length-1),Object(i["a"])(Object(i["a"])({},this.days[this.dayIdx]),{},{dateFormat:this.days[this.dayIdx].date_label,dateFormated:this.days[this.dayIdx].dateFormat}))},daysName:function(){return 6===this.days.length&&this.$screen.lt.lg&&this.$screen.gt.sm||7===this.days.length&&this.$screen.gt.sm?[this.trans("spa.days.mon_short"),this.trans("spa.days.tue_short"),this.trans("spa.days.wed_short"),this.trans("spa.days.thu_short"),this.trans("spa.days.fri_short"),this.trans("spa.days.sut_short"),this.trans("spa.days.sun_short")]:[this.trans("spa.days.mon"),this.trans("spa.days.tue"),this.trans("spa.days.wed"),this.trans("spa.days.thu"),this.trans("spa.days.fri"),this.trans("spa.days.sut"),this.trans("spa.days.sun")]},table:function(){return 0!==this.days.length?{rows:this.selectedDay.schedule}:{columns:[],rows:[]}},isNotEmptySchedule:function(){return this.days.length>0&&this.days[this.dayIdx].schedule.length>0||this.loading},isBirgeOqy:function(){return"birgeoqy"===this.getSchoolType},hiddenBirgeOqySchools:function(){return this.isTeacher&&this.isBirgeOqy}}),methods:{weekEndHandler:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=this.getNextUsersQuarter(this.getSelectedQuarter.value,!0),a=this.getNextUsersQuarter(this.getSelectedQuarter.value,!1);return t?this.isStudent&&!this.isBirgeOqy?!this.weeks.next&&this.$screen.gt.sm&&!s||!this.weeks.next&&this.$screen.lt.md&&e===this.days.length-1&&!s&&!this.days[this.dayIdx+1]:!this.weeks.next&&this.$screen.gt.sm||!this.weeks.next&&this.$screen.lt.md&&e===this.days.length-1:this.isStudent&&!this.isBirgeOqy?!this.weeks.prev&&this.$screen.gt.sm&&!a||!this.weeks.prev&&this.$screen.lt.md&&0===e&&!a&&!this.days[this.dayIdx-1]&&this.dayIdx-1:!this.weeks.prev&&this.$screen.gt.sm||!this.weeks.prev&&this.$screen.lt.md&&0===e},handleRefreshSchedule:function(e){return new Promise(function(t,s){return y.a.defaults.headers.common["X-No-Cache"]=!0,e?Promise.resolve(this.reqData(e)).then(function(e){try{return a.call(this)}catch(t){return s(t)}}.bind(this),s):Promise.resolve(this.reqData()).then(function(e){try{return a.call(this)}catch(t){return s(t)}}.bind(this),s);function a(){return delete y.a.defaults.headers.common["X-No-Cache"],t()}}.bind(this))},reqData:function(e){return new Promise(function(t,s){var a,n,r,i,o,l,c,d;return a=this,n=[_["a"].TCHR,_["a"].DCR,_["a"].ZVCH,_["a"].GL].includes(this.$store.getters.getRole)?this.$getUri("schedule.listTeacher"):this.$getUri("schedule.listStudent"),this.loading=!0,Promise.resolve(this.$http({url:n,params:{date:e}},!0)).then(function(e){try{return r=e,r.error&&418===r.errorType?(this.$emit("empty",!0),this.days=r.data.days,this.weeks=r.data.weeks,this.loading=!1,t()):r.error&&404===r.errorType?(this.$emit("empty",!0),null!==r&&void 0!==r&&null!==(i=r.data)&&void 0!==i&&i.message?(this.$notify({type:"error",title:this.trans(v["a"].error.title),text:r.data.message}),this.$store.commit("setScheduleDays",[]),this.$store.commit("setScheduleWeeks",{prev:"",prev_time:"",next:"",next_time:""}),this.loading=!1,t()):(this.days=r.data.days,this.weeks=r.data.weeks,this.loading=!1,t())):(r.error||(o=r.days[5]&&r.days[5].schedule&&(this.isEmployee||r.days[5].schedule.length>0),l=r.days[6]&&r.days[6].schedule&&r.days[6].schedule.length>0,0!==r.days.length&&l?r.days.length=7:0!==r.days.length&&o?r.days.length=6:0!==r.days.length&&(r.days.length=5),"student"===this.$store.getters.getRole&&r.days.forEach((function(e){e.schedule.forEach((function(e,t){e.number={label:t+1}}))})),this.$store.commit("setScheduleDays",r.days),this.$store.commit("setScheduleWeeks",r.weeks),null!==r&&void 0!==r&&r.multiSchool&&(this.multiSchool=r.multiSchool),this.isStudent&&r.groupInfo&&(this.$store.commit("setScheduleGroupInfo",r.groupInfo),(null===(c=r.groupInfo)||void 0===c?void 0:c.quarterStart)===this.firstSeptember.label&&(this.$route.params.date<=this.firstSeptember.label||!this.$route.params.date)&&f()().unix()<this.firstSeptember.time&&(d=r.days.findIndex((function(e){return e.date===a.firstSeptember.time})),this.selectDay(d))),0===this.days.length?this.$emit("empty",!0):this.$emit("empty",!1)),this.loading=!1,t())}catch(n){return s(n)}}.bind(this),s)}.bind(this))},changeWeek:function(e){return new Promise(function(t,s){var a,n;if(this.loading)return t();if(a=this.getNextUsersQuarter(this.getSelectedQuarter.value),n=this.getNextUsersQuarter(this.getSelectedQuarter.value,!1),e){return this.$screen.lt.md&&this.dayIdx<this.days.length-1?(this.$store.commit("setScheduleDayIdx",this.dayIdx+1),t()):this.weeks.next?(this.setDay(this.weeks.next_time),Promise.resolve(this.reqData(this.selectDate)).then(function(e){try{return this.selectDay(0),r.call(this)}catch(t){return s(t)}}.bind(this),s)):(!this.isBirgeOqy&&this.isStudent&&(this.$store.commit("setSelectedQuarter",a.value),this.setDay(a.startDate)),r.call(this));function r(){return o.call(this)}}{return this.$screen.lt.md&&this.dayIdx>0&&this.days[this.dayIdx-1]?(this.selectDay(this.dayIdx-1),t()):this.weeks.prev?(this.setDay(this.weeks.prev_time),Promise.resolve(this.reqData(this.selectDate)).then(function(e){try{return this.selectDay(this.days.length-1),i.call(this)}catch(t){return s(t)}}.bind(this),s)):(!this.isBirgeOqy&&this.isStudent&&(this.$store.commit("setSelectedQuarter",n.value),this.setDay(n.endDate)),i.call(this));function i(){return o.call(this)}}function o(){return t()}}.bind(this))},setDay:function(e){this.$store.commit("setScheduleSelectDate",e),this.$router.push({name:"VSchedulePage",params:{date:e}})},selectDay:function(e){this.$route.params.date!==this.days[e].dateFormat&&this.$router.push({name:"VSchedulePage",params:{date:this.days[e].dateFormat}}),this.$store.commit("setScheduleDayIdx",e)},handleShowModalAddLessonSchedule:function(){this.$glModalWindow.show({modalName:"add-schedule-lesson",modalTitle:this.trans("spa.title.add_to_schedule"),modalWidth:700,component:"v-schedule-add-lesson-modal-window",componentProps:{date:this.selectedDay.dateFormated,onModalClose:this.onAddLessonModalClose}})},handleModalSelectLessonTypeBeforeOpen:function(e){this.modalSelectLessonType.lessonId=e.params.lessonId,this.modalSelectLessonType.dateFormat=this.selectedDay.dateFormat},handleUpdateSchedule:function(){return new Promise(function(e,t){return this.selectDate=this.selectedDay.date,Promise.resolve(this.reqData(this.selectedDay.date)).then((function(s){try{return e()}catch(a){return t(a)}}),t)}.bind(this))},onAddLessonModalClose:function(){return new Promise(function(e,t){return this.$glModalWindow.hide("add-schedule-lesson"),y.a.defaults.headers.common["X-No-Cache"]=!0,this.selectDate&&g["a"].date.test(this.selectDate)?Promise.resolve(this.reqData(this.selectDate)).then(function(e){try{return s.call(this)}catch(a){return t(a)}}.bind(this),t):Promise.resolve(this.reqData()).then(function(e){try{return s.call(this)}catch(a){return t(a)}}.bind(this),t);function s(){return delete y.a.defaults.headers.common["X-No-Cache"],e()}}.bind(this))},editSchedule:function(){this.edit=!this.edit,this.$store.commit("setEditMode",this.edit)},requestUsersQuarters:function(){return new Promise(function(e,t){var s;return Promise.resolve(this.quarterService.fetchQuartersList()).then(function(a){try{return s=a,s.length>0&&this.$store.commit("setQuartersList",s),e()}catch(n){return t(n)}}.bind(this),t)}.bind(this))},getNextUsersQuarter:function(e){var t=this,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=null;return this.getQuartersList.forEach((function(n,r){n.quarters.forEach((function(i,o){if(i.value===e)if(s){if(o>0)return void(a=n.quarters[o-1]);if(r>0){var l=t.getQuartersList[r-1].quarters;a=l[l.length-1]}}else{if(o<n.quarters.length-1)return void(a=n.quarters[o+1]);r<t.getQuartersList.length-1&&(a=t.getQuartersList[r+1].quarters[0])}}))})),a}}},j=T,V=s("2877"),M=Object(V["a"])(j,d,h,!1,null,null,null),O=M.exports,F=s("5240"),B=s("6e52"),N=s("b2fb"),Q=s("35df"),H={name:"VSchedulePage",mixins:[l["a"]],components:{VBtn:c["a"],VSchedule:O,VTable:F["a"],VTableTr:B["a"],VTableTd:N["a"],VWarning:L["a"],VNotifyCount:Q["a"]},data:function(){return{isEmpty:!1,scheduleForDelete:null,deleteInProcess:!1,editModalParams:{},modalConflictTime:{lessons:[],callback:null,commonTime:null,noConfirmBtn:!0},colors:["ol-first-quarter__wrapper","ol-second-quarter__wrapper","ol-third-quarter__wrapper","ol-fourth-quarter__wrapper"]}},computed:Object(i["a"])(Object(i["a"])({},Object(o["c"])(["isEmployee","getSelectedYear","getSchoolType"])),{},{selectColorByQuarter:function(){for(var e=0;e<this.getSelectedYear.quarters.length;e++)if(this.getSelectedYear.quarters[e].current)return this.colors[e];return this.colors[0]},columns:function(){if(this.isEmployee){var e=[{name:"subject",label:this.trans("olessons.table.subject_and_class"),align:"left",width:240},{name:"time",label:this.trans("olessons.table.time_and_cabinet"),align:"center",width:140},{name:"theme",label:this.trans("olessons.table.theme"),align:"left"},{name:"lesson",label:this.trans("olessons.table.lesson"),align:"center",width:180}];return this.$store.getters.getEditModeState?e.push({name:"actions",label:this.trans("spa.table.th_actions"),align:"center",width:180}):e.push({name:"homework",label:this.trans("olessons.table.homework"),align:"center",width:180}),e}return[{name:"number",label:"№",align:"center",width:80},{name:"subject",label:this.trans("olessons.table.subject_and_teacher"),align:"left",width:200},{name:"time",label:this.trans("olessons.table.time_and_cabinet"),align:"center",width:170},{name:"theme",label:this.trans("olessons.table.theme"),align:"left"},{name:"lesson",label:this.trans("olessons.table.lesson"),align:"center",width:200},{name:"homework",label:this.trans("olessons.table.homework"),align:"center",width:200}]},isBirgeOqy:function(){return"birgeoqy"===this.getSchoolType}}),methods:{getButton:function(e,t,s){var a={color:"",outline:!1,disable:!1,label:""},n=this.$store.getters.getRole;return"sor"===e.type||"soch"===e.type?(a.color="white",a.label="done"===e[t].evaluation_status?this.trans("homework.verified"):this.trans("spa.action.go_over")):"created"===e[t].status?(a.color="aqua",a.label="done"===e[t].evaluation_status?this.trans("homework.verified"):this.trans("spa.action.go_over")):"empty"===e[t].status&&(a.color="orange",a.label=this.trans("spa.action.create"),this.getSelectedYear.current||(a.disable=!0)),"student"===n&&"empty"===e[t].status&&(a.outline=!0,a.disable=!0,a.color="grey",a.label=this.trans("spa.label.no_create")),!this.isEmployee&&s&&(s.isDisabledWeek&&(a.disable=!0),!["soch","sor"].includes(e.type)||s.isCurrent||s.isPastDate||(a.disable=!0)),a},transportTo:function(e,t,s){if(this.isEmployee){var a=t.calendarPlanLesson,n=a.uuid,r=a.entityId,i=a.entityKind;if("lecture"===i&&!r&&"lesson"===s)return void this.$router.push({name:"VCustomLessonCreateFromSchedule",params:{calendarPlanLessonUUID:n,date:this.$route.params.date}});if(!t.isVisible&&"lesson"===s)switch(i){case"sor":return void this.$router.push({name:"VLessonBuilderPage",params:{lessonId:r}});case"soch":return void this.$router.push({name:"VLessonBuilderSochPage",params:{lessonId:r}});case"custom-lesson":return void this.$router.push({name:"VLessonBuilderLessonPage",params:{lessonId:r}});default:break}}var o=this.$store.getters.getRole,l={name:"",params:{scheduleId:t.scheduleId,date:e.date,dateFormatted:e.dateFormated,isCurrent:e.isCurrent,group:t.class.label,groupId:t.class.groupId,subject:t.subject.label,subjectId:t.subject.subjectId,theme:t.theme.label,answerId:t.homework.answerId,homeworkId:t.homework.homeworkUUID,subgroup:{label:t.subgroup,uuid:t.subgroupUuid}}},c={director:{homework:{empty:"VHomeworkCreatePageFromSchedule",created:"VHomeworkAnswersListPage"},lesson:{empty:"",created:"VLessonPageFromSchedule"}},zavuch:{homework:{empty:"VHomeworkCreatePageFromSchedule",created:"VHomeworkAnswersListPage"},lesson:{empty:"",created:"VLessonPageFromSchedule"}},"group-lead":{homework:{empty:"VHomeworkCreatePageFromSchedule",created:"VHomeworkAnswersListPage"},lesson:{empty:"",created:"VLessonPageFromSchedule"}},teacher:{homework:{empty:"VHomeworkCreatePageFromSchedule",created:"VHomeworkAnswersListPage"},lesson:{empty:"",created:"VLessonPageFromSchedule"}},student:{homework:{empty:"",created:"VHomeworkAnswerShowPageS"},lesson:{empty:"",created:"VLessonPageFromSchedule"}}};c[o]&&c[o][s]&&c[o][s][t[s].status]&&(l.name=c[o][s][t[s].status],this.$route.params.date&&(l.params.date=this.$route.params.date),this.$router.push(l))},openDeleteModal:function(e){this.scheduleForDelete=e.scheduleUuid,this.$glModalWindow.show({modalName:"delete-confirm",modalTitle:this.trans("olessons.warning.delete_title"),modalWidth:480,component:"v-confirm-modal-window",componentProps:{colorSuccess:"red-pink",message:this.trans("spa.warning.delete_lesson_confirm"),handleSuccess:this.deleteSchedule,labelSuccess:this.trans("spa.action.delete"),labelReject:this.trans("spa.action.cancel")}})},openEditModal:function(e,t){this.editModalParams={theme:{uuid:e.calendarPlanLesson.uuid,label:e.theme.label},subjectId:e.subject.subjectId,groupId:e.class.groupId,scheduleUuid:e.scheduleUuid,timeStart:e.time.timeStart,timeEnd:e.time.timeEnd,subgroup:{label:e.subgroup,type:e.subgroupType},date:t,isVisible:e.isVisible,cabinet:e.cabinet},this.$glModalWindow.show({modalName:"edit-schedule",modalTitle:this.trans("spa.title.frontoffice_schedule_edit"),modalWidth:700,component:"v-schedule-edit-modal-window",componentProps:{modalParams:this.editModalParams,onScheduleEditConfirm:this.onEditConfirm}})},onEditConfirm:function(e,t,s){return new Promise(function(a,n){var i,o,l,c,d,h,u;return l=this,e.error?(null!==(i=e.data)&&void 0!==i&&null!==(o=i.errors)&&void 0!==o&&o.conflictTimeData&&(c=e.data.errors.conflictTimeData[0],d=this.trans("spa.action.change_time"),h=function(){},u=!0,c.every((function(e){return e.isAvailable}))&&(d=this.trans("spa.action.assign_anyway"),h=function(){return new Promise((function(e,s){return Promise.resolve(t(!0)).then((function(t){try{return Promise.resolve(l.lessonsLoad()).then((function(t){try{return e()}catch(a){return s(a)}}),s)}catch(a){return s(a)}}),s)}))},u=!1),this.modalConflictTime={lessons:Object(r["a"])(c),callback:h,confirmLabel:d,commonTime:s,noConfirmBtn:u},this.$glModalWindow.show({modalName:"conflict-time",modalTitle:this.trans("spa.warning.server_info_title"),modalWidth:500,component:"v-conflict-time-modal-window",componentProps:{modalConflictTime:this.modalConflictTime}})),m.call(this)):Promise.resolve(this.lessonsLoad()).then(function(e){try{return m.call(this)}catch(t){return n(t)}}.bind(this),n);function m(){return a()}}.bind(this))},lessonsLoad:function(){return new Promise(function(e,t){return Promise.resolve(this.$eventHub.$emit("refresh-schedule")).then(function(s){try{return this.$glModalWindow.hide("edit-schedule"),e()}catch(a){return t(a)}}.bind(this),t)}.bind(this))},deleteSchedule:function(){return new Promise(function(e,t){var s,a;return a=null,this.deleteInProcess=!0,Promise.resolve(this.$http({method:"post",url:this.$getUri("schedule.remove",{scheduleUuid:this.scheduleForDelete})})).then(function(n){try{return a=n,null!==(s=a)&&void 0!==s&&s.error||this.$eventHub.$emit("refresh-schedule"),this.deleteInProcess=!1,e()}catch(r){return t(r)}}.bind(this),t)}.bind(this))},multiSchoolTitle:function(e){return e.class.schoolName.split("-")[0]}}},W=H,U=Object(V["a"])(W,a,n,!1,null,null,null);t["default"]=U.exports}}]);